<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cat Pill Game ‚Äî v4 (Drag to Emoji Cat)</title>
<style>
  :root{
    --bg:#0f172a; --panel:#0b1220; --text:#e5e7eb; --accent:#22d3ee;
    --good:#34d399; --warn:#fbbf24; --bad:#f87171;
  }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100svh; display:grid; place-items:center;
    color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;
    background: radial-gradient(1200px 800px at 50% -200px,#1f2937 0%,var(--bg) 45%);
  }
  .wrap{width:min(960px,96vw);}
  header{display:flex;justify-content:space-between;align-items:center;gap:.75rem;margin:1rem 0 .5rem;}
  h1{margin:0;font-size:clamp(1rem,2.5vw,1.2rem);opacity:.9}
  .hud{display:flex;align-items:center;gap:.75rem;font-weight:600}
  .badge{
    background:linear-gradient(180deg,#16223a,#0b1220);
    border:1px solid rgba(255,255,255,.1);
    border-radius:10px;padding:.35rem .6rem;display:inline-flex;gap:.4rem;align-items:center;
    box-shadow:inset 0 8px 24px rgba(0,0,0,.2),0 4px 12px rgba(0,0,0,.25);
  }
  .score{color:var(--accent)}
  .hearts{letter-spacing:2px}

  .stage{
    position:relative; border-radius:16px; overflow:hidden;
    border:1px solid rgba(255,255,255,.08);
    background:linear-gradient(180deg,rgba(34,211,238,.06), rgba(255,255,255,.02));
    box-shadow:0 30px 80px rgba(0,0,0,.35), inset 0 6px 24px rgba(255,255,255,.03);
    width:100%; height:min(62vh,560px); min-height:420px;
    touch-action:none; user-select:none;
  }
  /* Play area guides */
  .top-zone{
    position:absolute; inset:0 0 36% 0; /* top ~64% */
    background: repeating-linear-gradient(180deg, transparent 0px, transparent 28px, rgba(255,255,255,.04) 28px, rgba(255,255,255,.04) 56px);
    pointer-events:none;
  }

  /* Cat (emoji) */
  .cat{
    position:absolute; left:50%; transform:translateX(-50%);
    bottom:18px; font-size:clamp(56px,10vw,96px); line-height:1;
    filter: drop-shadow(0 10px 20px rgba(0,0,0,.3));
    transition: transform .12s ease;
    will-change: transform;
  }
  .cat.hungry{ transform:translateX(-50%) scale(1); }
  .cat.bite{   transform:translateX(-50%) scale(1.1); } /* quick ‚Äúmouth open‚Äù pop */

  /* Pill (draggable) */
  .pill{
    position:absolute; font-size:clamp(34px,7.5vw,56px); line-height:1; cursor:grab;
    touch-action:none; user-select:none;
    transition: transform .05s linear;
    will-change: transform, left, top;
  }
  .pill:active{ cursor:grabbing; }

  /* Overlay */
  .overlay{
    position:absolute; inset:0; display:grid; place-items:center;
    background:rgba(0,0,0,.45); backdrop-filter: blur(4px);
  }
  .card{
    text-align:center; width:min(420px,90%);
    background:linear-gradient(180deg,#0b1220,#0a0f1a);
    border:1px solid rgba(255,255,255,.1);
    padding:1rem 1.2rem; border-radius:14px;
    box-shadow:0 18px 60px rgba(0,0,0,.45);
  }
  .card h2{margin:.1rem 0 .4rem;font-size:1.1rem}
  .card p{margin:0 0 .8rem; opacity:.85}
  .btn{
    width:100%; border:none; border-radius:10px; padding:.65rem .9rem; font-weight:800; cursor:pointer;
    color:#06121a; background:linear-gradient(180deg,#22d3ee,#14b8a6);
  }
  .controls{font-size:.9rem; opacity:.8; margin-top:.6rem; line-height:1.25rem}
  footer{opacity:.6; font-size:.85rem; margin:.6rem 0 1.2rem; text-align:center}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>üê± Cat Pill Game ‚Äî v4</h1>
      <div class="hud">
        <div class="badge">Score: <span id="score" class="score">0</span></div>
        <div class="badge">Lives: <span id="hearts" class="hearts">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></div>
      </div>
    </header>

    <div class="stage" id="stage" aria-label="Drag the pill to the cat">
      <div class="top-zone" aria-hidden="true"></div>
      <div id="cat" class="cat hungry" aria-label="Cat">üê±</div>

      <div class="overlay" id="overlay">
        <div class="card">
          <h2 id="title">Drag the üíä to the üê±</h2>
          <p id="subtitle">Feed the cat to score points. Dropping the pill elsewhere costs a life. 3 lives total.</p>
          <button class="btn" id="startBtn">Tap / Click to Start</button>
          <div class="controls">
            Desktop: click & drag the pill<br/>
            Mobile: touch & drag the pill
          </div>
        </div>
      </div>
    </div>

    <footer>Place <strong>meow.mp3</strong> next to this file.</footer>
  </div>

<script>
(() => {
  const stage = document.getElementById('stage');
  const catEl = document.getElementById('cat');
  const overlay = document.getElementById('overlay');
  const startBtn = document.getElementById('startBtn');
  const scoreEl = document.getElementById('score');
  const heartsEl = document.getElementById('hearts');
  const titleEl = document.getElementById('title');
  const subtitleEl = document.getElementById('subtitle');

  // Sound
  const meow = new Audio('meow.mp3');
  meow.preload = 'auto'; meow.volume = 0.85;

  // optional tiny buzz for a miss
  let audioCtx;
  function buzz(){
    try{
      audioCtx = audioCtx || new (window.AudioContext||window.webkitAudioContext)();
      if(audioCtx.state==='suspended') audioCtx.resume();
      const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
      o.type='square'; o.frequency.value=220;
      g.gain.value=0.0001;
      g.gain.exponentialRampToValueAtTime(0.06, audioCtx.currentTime + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.14);
      o.connect(g).connect(audioCtx.destination);
      o.start(); o.stop(audioCtx.currentTime + 0.16);
    }catch{}
  }

  const state = {
    running:false, score:0, lives:3,
    pillEl:null, dragging:false,
    offsetX:0, offsetY:0,
  };

  function updateHUD(){
    scoreEl.textContent = state.score;
    heartsEl.textContent = '‚ù§Ô∏è'.repeat(state.lives) + 'üñ§'.repeat(3-state.lives);
  }

  function resetGame(){
    state.score = 0; state.lives = 3; updateHUD();
    removePill(); createPill();
    catEl.classList.remove('bite'); catEl.classList.add('hungry');
  }

  function start(){
    overlay.style.display = 'none';
    state.running = true;
    resetGame();
  }

  function gameOver(){
    state.running = false;
    removePill();
    titleEl.textContent = 'Game Over üòø';
    subtitleEl.textContent = `Final score: ${state.score}`;
    startBtn.textContent = 'Play Again';
    overlay.style.display = 'grid';
  }

  function createPill(){
    const pill = document.createElement('div');
    pill.className = 'pill';
    pill.textContent = 'üíä';
    stage.appendChild(pill);

    // place the pill somewhere in the top zone
    const rect = stage.getBoundingClientRect();
    const topH = rect.height * 0.64;
    const left = Math.random() * (rect.width - 64) + 16;
    const top  = Math.random() * (topH - 80) + 16;
    pill.style.left = left + 'px';
    pill.style.top  = top  + 'px';

    // store
    state.pillEl = pill;

    // attach events
    pill.addEventListener('pointerdown', startDrag, {passive:false});
  }

  function removePill(){
    if(state.pillEl && state.pillEl.parentNode){
      state.pillEl.remove();
      state.pillEl = null;
    }
  }

  function startDrag(e){
    if(!state.running) return;
    e.preventDefault();
    const pill = state.pillEl;
    if(!pill) return;
    pill.setPointerCapture(e.pointerId);
    state.dragging = true;

    const pillRect = pill.getBoundingClientRect();
    state.offsetX = e.clientX - pillRect.left;
    state.offsetY = e.clientY - pillRect.top;

    document.addEventListener('pointermove', onDrag, {passive:false});
    document.addEventListener('pointerup', endDrag, {once:true, passive:false});
  }

  function onDrag(e){
    if(!state.dragging || !state.pillEl) return;
    e.preventDefault();
    const rect = stage.getBoundingClientRect();

    let x = e.clientX - rect.left - state.offsetX;
    let y = e.clientY - rect.top  - state.offsetY;

    // constrain inside stage
    x = Math.max(0, Math.min(rect.width - 56, x));
    y = Math.max(0, Math.min(rect.height - 56, y));

    state.pillEl.style.left = x + 'px';
    state.pillEl.style.top  = y + 'px';
  }

  function endDrag(e){
    if(!state.dragging) return;
    state.dragging = false;
    document.removeEventListener('pointermove', onDrag);

    if(!state.pillEl) return;

    // Check drop overlap with the cat
    const catR = catEl.getBoundingClientRect();
    const pillR = state.pillEl.getBoundingClientRect();

    const overlap = !(pillR.right < catR.left || pillR.left > catR.right || pillR.bottom < catR.top || pillR.top > catR.bottom);

    if(overlap){
      // success
      try{ meow.currentTime = 0; meow.play(); }catch{}
      catEl.classList.remove('hungry');
      catEl.classList.add('bite');
      // quick bite animation reset
      setTimeout(()=>{ catEl.classList.remove('bite'); catEl.classList.add('hungry'); }, 160);

      state.score += 1; updateHUD();
      // spawn a new pill
      removePill(); createPill();
    }else{
      // miss
      buzz();
      state.lives -= 1; updateHUD();
      if(state.lives <= 0){ gameOver(); return; }

      // reposition the same pill back to the top zone to try again
      snapPillBackToTop();
    }
  }

  function snapPillBackToTop(){
    if(!state.pillEl) return;
    const rect = stage.getBoundingClientRect();
    const topH = rect.height * 0.64;
    const left = Math.random() * (rect.width - 64) + 16;
    const top  = Math.random() * (topH - 80) + 16;
    state.pillEl.style.left = left + 'px';
    state.pillEl.style.top  = top  + 'px';
  }

  // Start button: also helps unlock audio on iOS
  startBtn.addEventListener('click', () => {
    try { meow.play().then(()=>{ meow.pause(); meow.currentTime = 0; }).catch(()=>{}); } catch {}
    start();
  });

  // Resize safety: keep pill in bounds if viewport changes
  window.addEventListener('resize', () => {
    if(!state.pillEl) return;
    const rect = stage.getBoundingClientRect();
    const pillR = state.pillEl.getBoundingClientRect();
    let x = pillR.left - rect.left;
    let y = pillR.top - rect.top;
    x = Math.max(0, Math.min(rect.width - 56, x));
    y = Math.max(0, Math.min(rect.height - 56, y));
    state.pillEl.style.left = x + 'px';
    state.pillEl.style.top  = y + 'px';
  }, {passive:true});

})();
</script>
</body>
</html>
