<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cat Pill Game ‚Äî v7 (Mild/Wild + 2D Motion)</title>
<style>
  :root{ --bg:#0f172a; --panel:#0b1220; --text:#e5e7eb; --accent:#22d3ee; --warn:#fbbf24; }
  *{ box-sizing:border-box }
  body{
    margin:0; min-height:100svh; display:grid; place-items:center; color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;
    background: radial-gradient(1200px 800px at 50% -200px,#1f2937 0%,var(--bg) 45%);
  }
  .wrap{ width:min(960px,96vw); }
  header{ display:flex; justify-content:space-between; align-items:center; gap:.75rem; margin:1rem 0 .5rem; flex-wrap:wrap }
  h1{ margin:0; font-size:clamp(1rem,2.5vw,1.2rem); opacity:.9 }
  .hud{ display:flex; align-items:center; gap:.5rem; flex-wrap:wrap; font-weight:600 }
  .badge{
    background:linear-gradient(180deg,#16223a,#0b1220);
    border:1px solid rgba(255,255,255,.12);
    border-radius:10px; padding:.35rem .6rem; display:inline-flex; gap:.4rem; align-items:center;
    box-shadow:inset 0 8px 24px rgba(0,0,0,.2), 0 4px 12px rgba(0,0,0,.25);
  }
  .score{ color:var(--accent) }
  .level{ color:var(--warn) }
  .mode-btn{
    border:none; padding:.35rem .6rem; border-radius:10px; font-weight:800; cursor:pointer;
    color:#06121a; background:linear-gradient(180deg,#22d3ee,#14b8a6);
  }

  .stage{
    position:relative; border-radius:16px; overflow:hidden;
    border:1px solid rgba(255,255,255,.08);
    background:linear-gradient(180deg,rgba(34,211,238,.06), rgba(255,255,255,.02));
    box-shadow:0 30px 80px rgba(0,0,0,.35), inset 0 6px 24px rgba(255,255,255,.03);
    width:100%; height:min(62vh,560px); min-height:420px;
    touch-action:none; user-select:none;
  }
  .top-zone{
    position:absolute; inset:0 0 36% 0;
    background: repeating-linear-gradient(180deg, transparent 0px, transparent 28px, rgba(255,255,255,.04) 28px, rgba(255,255,255,.04) 56px);
    pointer-events:none;
  }

  /* Cat emoji (2D positioned using left + bottom) */
  .cat{
    position:absolute; left:50%; bottom:18px; transform:translateX(-50%);
    font-size:clamp(56px,10vw,96px); line-height:1;
    filter: drop-shadow(0 10px 20px rgba(0,0,0,.3));
    transition: transform .12s ease;
    will-change: transform, left, bottom;
  }
  .cat.hungry{ transform:translateX(-50%) scale(1); }
  .cat.bite{   transform:translateX(-50%) scale(1.1); }
  .cat.dash{   transform:translateX(-50%) scale(1.12) translateY(-2px); text-shadow:-6px 0 rgba(255,255,255,.12), -12px 0 rgba(255,255,255,.06); }
  @keyframes fakeShake { 0%,100%{transform:translateX(-50%) translateY(0) scale(1)} 50%{transform:translateX(-50%) translateY(-2px) scale(1)} }
  .cat.fake{ animation: fakeShake .28s ease-in-out; }

  .pill{
    position:absolute; font-size:clamp(34px,7.5vw,56px); line-height:1; cursor:grab;
    touch-action:none; user-select:none; will-change: left, top; transition: transform .05s linear;
  }
  .pill:active{ cursor:grabbing; }

  .overlay{
    position:absolute; inset:0; display:grid; place-items:center;
    background:rgba(0,0,0,.45); backdrop-filter: blur(4px);
  }
  .card{
    text-align:center; width:min(460px,92%);
    background:linear-gradient(180deg,#0b1220,#0a0f1a);
    border:1px solid rgba(255,255,255,.12);
    padding:1rem 1.2rem; border-radius:14px;
    box-shadow:0 18px 60px rgba(0,0,0,.45);
  }
  .card h2{ margin:.1rem 0 .4rem; font-size:1.1rem }
  .card p{ margin:0 0 .8rem; opacity:.85 }
  .btn{
    width:100%; border:none; border-radius:10px; padding:.65rem .9rem; font-weight:800; cursor:pointer;
    color:#06121a; background:linear-gradient(180deg,#22d3ee,#14b8a6);
  }
  .controls{ font-size:.9rem; opacity:.8; margin-top:.6rem; line-height:1.25rem }
  footer{ opacity:.6; font-size:.85rem; margin:.6rem 0 1.2rem; text-align:center }

  .toast{
    position:absolute; left:50%; top:14%; transform:translateX(-50%);
    padding:.4rem .7rem; border-radius:999px; font-weight:800;
    background:linear-gradient(180deg,#22d3ee,#14b8a6); color:#06121a;
    border:1px solid rgba(255,255,255,.18); box-shadow:0 14px 40px rgba(0,0,0,.35);
    opacity:0; pointer-events:none; transition:opacity .25s ease, transform .25s ease;
  }
  .toast.show{ opacity:1; transform:translateX(-50%) translateY(-6px); }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>üê± Cat Pill Game ‚Äî v7</h1>
      <div class="hud">
        <div class="badge">Score: <span id="score" class="score">0</span></div>
        <div class="badge">Lives: <span id="hearts">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></div>
        <div class="badge">Level: <span id="level" class="level">1</span></div>
        <button class="mode-btn" id="modeBtn" aria-pressed="false" title="Toggle Mild/Wild">Mode: Mild</button>
      </div>
    </header>

    <div class="stage" id="stage" aria-label="Drag the pill to the moving cat">
      <div class="top-zone" aria-hidden="true"></div>
      <div id="cat" class="cat hungry" aria-label="Cat">üê±</div>
      <div class="toast" id="toast">Level Up!</div>

      <div class="overlay" id="overlay">
        <div class="card">
          <h2 id="title">Drag the üíä to the üê±</h2>
          <p id="subtitle">
            Feed the cat to score points. Misses cost a life (3 total).<br/>
            The cat moves in 2D. Every 5 feeds ‚Üí next level (faster). Choose <strong>Mild</strong> or <strong>Wild</strong>!
          </p>
          <button class="btn" id="startBtn">Tap / Click to Start</button>
          <div class="controls">Desktop: click & drag ¬∑ Mobile: touch & drag</div>
        </div>
      </div>
    </div>

    <footer>Place <strong>meow.mp3</strong> next to this file.</footer>
  </div>

<script>
(() => {
  const stage = document.getElementById('stage');
  const catEl = document.getElementById('cat');
  const overlay = document.getElementById('overlay');
  const startBtn = document.getElementById('startBtn');
  const scoreEl = document.getElementById('score');
  const heartsEl = document.getElementById('hearts');
  const levelEl = document.getElementById('level');
  const toastEl = document.getElementById('toast');
  const modeBtn = document.getElementById('modeBtn');

  // Sound
  const meow = new Audio('meow.mp3'); meow.preload = 'auto'; meow.volume = 0.85;

  // tiny buzz for miss
  let audioCtx;
  function buzz(){
    try{
      audioCtx = audioCtx || new (window.AudioContext||window.webkitAudioContext)();
      if(audioCtx.state==='suspended') audioCtx.resume();
      const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
      o.type='square'; o.frequency.value=220;
      g.gain.value=0.0001;
      g.gain.exponentialRampToValueAtTime(0.06, audioCtx.currentTime + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.14);
      o.connect(g).connect(audioCtx.destination);
      o.start(); o.stop(audioCtx.currentTime + 0.16);
    }catch{}
  }

  const state = {
    running:false, score:0, lives:3, level:1,
    mode:'mild',                            // 'mild' | 'wild'
    pillEl:null, dragging:false, offsetX:0, offsetY:0,
    // cat motion (2D)
    catX:0, catYBottom:18, catDirX:1, catDirY:1,
    catSpeedBase:90, catSpeedYFactor:0.75,  // vertical slightly slower for control
    lastTime:0, feedsThisLevel:0,
    // specials
    dashActive:false, dashTimer:0, dashMult:2.4, dashCooldown:0,
    fakeActive:false, fakeTimer:0, fakeCooldown:0,
  };

  // --- Mode tuning ---
  function applyMode(){
    // Baselines per mode
    if(state.mode === 'mild'){
      state.catSpeedBase = 90;               // base px/s per level
      state.catSpeedYFactor = 0.70;
      state.dashMult = 2.2;
      dashPerSecBase = 0.04; dashPerSecPerLvl = 0.009;
      fakePerSec = 0.035;
      vertBandRatio = 0.18;                  // bottom 18% of stage
      randomFlipBase = 0.0008; randomFlipPerLvl = 0.0003;
    } else { // wild
      state.catSpeedBase = 110;
      state.catSpeedYFactor = 0.85;
      state.dashMult = 2.8;
      dashPerSecBase = 0.07; dashPerSecPerLvl = 0.014;
      fakePerSec = 0.055;
      vertBandRatio = 0.32;                  // bottom 32% of stage
      randomFlipBase = 0.0012; randomFlipPerLvl = 0.0006;
    }
  }
  // defaults (initialized by applyMode in reset)
  let dashPerSecBase=0.04, dashPerSecPerLvl=0.009, fakePerSec=0.035, vertBandRatio=0.18, randomFlipBase=0.0008, randomFlipPerLvl=0.0003;

  function catBaseSpeedForLevel(lvl){
    return state.catSpeedBase + (lvl-1) * 45; // level scaling
  }

  function updateHUD(){
    scoreEl.textContent = state.score;
    heartsEl.textContent = '‚ù§Ô∏è'.repeat(state.lives) + 'üñ§'.repeat(3-state.lives);
    levelEl.textContent = state.level;
  }

  function levelUp(){
    state.level += 1;
    state.feedsThisLevel = 0;
    updateHUD();
    toastEl.textContent = `Level ${state.level}!`;
    toastEl.classList.add('show');
    setTimeout(()=>toastEl.classList.remove('show'), 900);
  }

  function resetGame(){
    applyMode();
    state.score=0; state.lives=3; state.level=1; state.feedsThisLevel=0;
    updateHUD();
    removePill(); createPill();

    const rect = stage.getBoundingClientRect();
    const catRect = catEl.getBoundingClientRect();
    state.catX = (rect.width - catRect.width)/2;
    // vertical band: from 12px above bottom up to vertBandRatio * height
    state.catYBottom = 18; // start near bottom
    catEl.style.left = `${state.catX}px`;
    catEl.style.bottom = `${state.catYBottom}px`;

    state.catDirX = Math.random()<0.5 ? -1 : 1;
    state.catDirY = Math.random()<0.5 ? -1 : 1;
    state.dashActive=false; state.dashTimer=0; state.dashCooldown=0;
    state.fakeActive=false; state.fakeTimer=0; state.fakeCooldown=0;

    catEl.className = 'cat hungry';
    state.lastTime = performance.now();
    requestAnimationFrame(loop);
  }

  function start(){
    overlay.style.display = 'none';
    state.running = true;
    resetGame();
  }

  function gameOver(){
    state.running = false;
    removePill();
    const title = document.getElementById('title');
    const subtitle = document.getElementById('subtitle');
    title.textContent = 'Game Over üòø';
    subtitle.textContent = `Final score: ${state.score} ¬∑ Level: ${state.level} ¬∑ Mode: ${state.mode.toUpperCase()}`;
    document.getElementById('startBtn').textContent = 'Play Again';
    overlay.style.display = 'grid';
  }

  // --- Pill management (drag & drop) ---
  function createPill(){
    const pill = document.createElement('div');
    pill.className = 'pill'; pill.textContent = 'üíä';
    stage.appendChild(pill);

    const rect = stage.getBoundingClientRect();
    const topH = rect.height * 0.64;
    const left = Math.random() * (rect.width - 64) + 16;
    const top  = Math.random() * (topH - 80) + 16;
    pill.style.left = left + 'px';
    pill.style.top  = top  + 'px';
    state.pillEl = pill;

    pill.addEventListener('pointerdown', startDrag, {passive:false});
  }

  function removePill(){ if(state.pillEl){ state.pillEl.remove(); state.pillEl = null; } }

  function startDrag(e){
    if(!state.running) return;
    e.preventDefault();
    const pill = state.pillEl; if(!pill) return;
    pill.setPointerCapture(e.pointerId);
    state.dragging = true;

    const r = pill.getBoundingClientRect();
    state.offsetX = e.clientX - r.left;
    state.offsetY = e.clientY - r.top;

    document.addEventListener('pointermove', onDrag, {passive:false});
    document.addEventListener('pointerup', endDrag, {once:true, passive:false});
  }

  function onDrag(e){
    if(!state.dragging || !state.pillEl) return;
    e.preventDefault();
    const rect = stage.getBoundingClientRect();
    let x = e.clientX - rect.left - state.offsetX;
    let y = e.clientY - rect.top  - state.offsetY;
    x = Math.max(0, Math.min(rect.width - 56, x));
    y = Math.max(0, Math.min(rect.height - 56, y));
    state.pillEl.style.left = x + 'px';
    state.pillEl.style.top  = y + 'px';
  }

  function endDrag(){
    if(!state.dragging) return;
    state.dragging = false;
    document.removeEventListener('pointermove', onDrag);
    if(!state.pillEl) return;

    const catR = catEl.getBoundingClientRect();
    const pillR = state.pillEl.getBoundingClientRect();
    const overlap = !(pillR.right < catR.left || pillR.left > catR.right || pillR.bottom < catR.top || pillR.top > catR.bottom);

    if(overlap){
      try{ meow.currentTime = 0; meow.play(); }catch{}
      catEl.classList.remove('hungry'); catEl.classList.add('bite');
      setTimeout(()=>{ catEl.classList.remove('bite'); catEl.classList.add('hungry'); }, 160);

      state.score += 1; updateHUD();
      state.feedsThisLevel += 1;
      if(state.feedsThisLevel >= 5){ levelUp(); }

      removePill(); createPill();
    }else{
      buzz();
      state.lives -= 1; updateHUD();
      if(state.lives <= 0) return gameOver();
      snapPillBackToTop();
    }
  }

  function snapPillBackToTop(){
    if(!state.pillEl) return;
    const rect = stage.getBoundingClientRect();
    const topH = rect.height * 0.64;
    const left = Math.random() * (rect.width - 64) + 16;
    const top  = Math.random() * (topH - 80) + 16;
    state.pillEl.style.left = left + 'px';
    state.pillEl.style.top  = top  + 'px';
  }

  // --- Specials ---
  function maybeTriggerDash(dt){
    if(state.dashActive || state.fakeActive || state.dashCooldown > 0) return;
    const pPerSec = dashPerSecBase + dashPerSecPerLvl * (state.level - 1);
    if(Math.random() < pPerSec * dt){
      state.dashActive = true;
      state.dashTimer = Math.min(1.0, 0.45 + 0.04 * (state.level - 1));
      state.dashCooldown = 1.05;
      catEl.classList.add('dash');
    }
  }
  function maybeTriggerFake(dt){
    if(state.fakeActive || state.dashActive || state.fakeCooldown > 0) return;
    if(Math.random() < fakePerSec * dt){
      state.fakeActive = true;
      state.fakeTimer = 0.28 + Math.random()*0.18;
      state.fakeCooldown = 1.2;
      catEl.classList.add('fake');
    }
  }

  // --- Main loop: 2D motion, specials, randomness ---
  function loop(now){
    if(!state.running) return;
    const dt = Math.min(0.033, (now - state.lastTime)/1000);
    state.lastTime = now;

    state.dashCooldown = Math.max(0, state.dashCooldown - dt);
    state.fakeCooldown = Math.max(0, state.fakeCooldown - dt);

    maybeTriggerDash(dt);
    maybeTriggerFake(dt);

    const rect = stage.getBoundingClientRect();
    const catRect = catEl.getBoundingClientRect();

    // vertical band (bottom portion of stage)
    const minBottom = 12;
    const maxBottom = Math.max(60, rect.height * vertBandRatio);

    // Effective speeds
    let base = catBaseSpeedForLevel(state.level);
    let vx = base;
    let vy = base * state.catSpeedYFactor;

    if(state.dashActive){ vx *= state.dashMult; vy *= state.dashMult; }
    if(state.fakeActive){ vx = 0; vy = 0; }

    // Count down specials
    if(state.dashActive){
      state.dashTimer -= dt;
      if(state.dashTimer <= 0){
        state.dashActive = false;
        catEl.classList.remove('dash');
        if(Math.random() < 0.4) state.catDirX *= -1;
        if(Math.random() < 0.25) state.catDirY *= -1;
      }
    }
    if(state.fakeActive){
      state.fakeTimer -= dt;
      if(state.fakeTimer <= 0){
        state.fakeActive = false;
        catEl.classList.remove('fake');
        if(Math.random() < 0.65) state.catDirX *= -1;
        if(Math.random() < 0.45) state.catDirY *= -1;
      }
    }

    // Move X
    state.catX += state.catDirX * vx * dt;
    const minX = 6, maxX = rect.width - catRect.width - 6;
    if(state.catX <= minX){ state.catX = minX; state.catDirX = 1; }
    else if(state.catX >= maxX){ state.catX = maxX; state.catDirX = -1; }

    // Move Y (by changing CSS bottom)
    state.catYBottom += state.catDirY * vy * dt;
    if(state.catYBottom <= minBottom){ state.catYBottom = minBottom; state.catDirY = 1; }
    else if(state.catYBottom >= maxBottom){ state.catYBottom = maxBottom; state.catDirY = -1; }

    // Occasional random flips (keep it unpredictable)
    if(!state.fakeActive && !state.dashActive){
      if(Math.random() < (randomFlipBase + randomFlipPerLvl*state.level)) state.catDirX *= -1;
      if(Math.random() < (randomFlipBase*0.8 + randomFlipPerLvl*0.6*state.level)) state.catDirY *= -1;
    }

    // Apply position
    catEl.style.left = `${state.catX}px`;
    catEl.style.bottom = `${state.catYBottom}px`;

    requestAnimationFrame(loop);
  }

  // --- Mode toggle ---
  modeBtn.addEventListener('click', () => {
    state.mode = state.mode === 'mild' ? 'wild' : 'mild';
    modeBtn.textContent = `Mode: ${state.mode[0].toUpperCase()+state.mode.slice(1)}`;
    modeBtn.setAttribute('aria-pressed', state.mode === 'wild' ? 'true' : 'false');
    // If game running, re-apply tuning immediately (keeps current level/score)
    applyMode();
  });

  // Start button (also unlocks audio on iOS)
  startBtn.addEventListener('click', () => {
    try{ meow.play().then(()=>{ meow.pause(); meow.currentTime=0; }).catch(()=>{}); }catch{}
    start();
  });

  // Keep elements in bounds on resize
  window.addEventListener('resize', () => {
    const rect = stage.getBoundingClientRect();
    const catRect = catEl.getBoundingClientRect();
    const maxX = rect.width - catRect.width - 6;
    const maxBottom = Math.max(60, rect.height * vertBandRatio);
    state.catX = Math.max(6, Math.min(maxX, state.catX));
    state.catYBottom = Math.max(12, Math.min(maxBottom, state.catYBottom));
    catEl.style.left = `${state.catX}px`;
    catEl.style.bottom = `${state.catYBottom}px`;

    if(state.pillEl){
      const pillR = state.pillEl.getBoundingClientRect();
      let x = pillR.left - rect.left;
      let y = pillR.top  - rect.top;
      x = Math.max(0, Math.min(rect.width - 56, x));
      y = Math.max(0, Math.min(rect.height - 56, y));
      state.pillEl.style.left = x + 'px';
      state.pillEl.style.top  = y + 'px';
    }
  }, {passive:true});
})();
</script>
</body>
</html>
